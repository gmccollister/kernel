From 6bc38a832bc08b6b69f751d90ad3bb845c7c3fad Mon Sep 17 00:00:00 2001
From: Felipe Balbi <felipe.balbi@nokia.com>
Date: Mon, 26 Apr 2010 18:23:15 -0700
Subject: [PATCH 0257/1092] cbus: retu-wdt: remove the platform_device

it now comes from retu.c, so use that.

Signed-off-by: Felipe Balbi <felipe.balbi@nokia.com>
---
 drivers/cbus/retu-wdt.c | 34 +---------------------------------
 1 file changed, 1 insertion(+), 33 deletions(-)

diff --git a/drivers/cbus/retu-wdt.c b/drivers/cbus/retu-wdt.c
index 03aa576..4d2ed33 100644
--- a/drivers/cbus/retu-wdt.c
+++ b/drivers/cbus/retu-wdt.c
@@ -33,7 +33,6 @@
 #include <linux/completion.h>
 #include <linux/errno.h>
 #include <linux/moduleparam.h>
-#include <linux/platform_device.h>
 #include <linux/miscdevice.h>
 #include <linux/watchdog.h>
 
@@ -49,7 +48,6 @@
 #define RETU_WDT_DEFAULT_TIMER 32
 #define RETU_WDT_MAX_TIMER 63
 
-static struct completion retu_wdt_completion;
 static DEFINE_MUTEX(retu_wdt_mutex);
 
 /* Current period of watchdog */
@@ -322,21 +320,8 @@ static int __devexit retu_wdt_remove(struct device *dev)
 	return 0;
 }
 
-static void retu_wdt_device_release(struct device *dev)
-{
-	complete(&retu_wdt_completion);
-}
-
-static struct platform_device retu_wdt_device = {
-	.name = "retu-watchdog",
-	.id = -1,
-	.dev = {
-		.release = retu_wdt_device_release,
-	},
-};
-
 static struct device_driver retu_wdt_driver = {
-	.name = "retu-watchdog",
+	.name = "retu-wdt",
 	.bus = &platform_bus_type,
 	.probe = retu_wdt_probe,
 	.remove = __devexit_p(retu_wdt_remove),
@@ -350,16 +335,10 @@ static int __init retu_wdt_init(void)
 	if (!ret)
 		return -ENODEV;
 
-	init_completion(&retu_wdt_completion);
-
 	ret = driver_register(&retu_wdt_driver);
 	if (ret)
 		return ret;
 
-	ret = platform_device_register(&retu_wdt_device);
-	if (ret)
-		goto exit1;
-
 	/* passed as module parameter? */
 	ret = retu_modify_counter(counter_param);
 	if (ret == -EINVAL) {
@@ -368,23 +347,12 @@ static int __init retu_wdt_init(void)
 		       "retu_wdt_init: Intializing to default value\n");
 	}
 
-	printk(KERN_INFO "Retu watchdog driver initialized\n");
-
 	return retu_wdt_ping();
-
-exit1:
-	driver_unregister(&retu_wdt_driver);
-	wait_for_completion(&retu_wdt_completion);
-
-	return ret;
 }
 
 static void __exit retu_wdt_exit(void)
 {
-	platform_device_unregister(&retu_wdt_device);
 	driver_unregister(&retu_wdt_driver);
-
-	wait_for_completion(&retu_wdt_completion);
 }
 
 module_init(retu_wdt_init);
-- 
1.7.11.2


From 0341363445e68aedfc2d2db71711c9c33d21dc85 Mon Sep 17 00:00:00 2001
From: Felipe Balbi <felipe.balbi@nokia.com>
Date: Mon, 26 Apr 2010 18:22:36 -0700
Subject: [PATCH 0250/1092] cbus: retu-rtc: remove platform_device code

that comes from retu.c now.

Signed-off-by: Felipe Balbi <felipe.balbi@nokia.com>
---
 drivers/cbus/retu-rtc.c | 33 +--------------------------------
 1 file changed, 1 insertion(+), 32 deletions(-)

diff --git a/drivers/cbus/retu-rtc.c b/drivers/cbus/retu-rtc.c
index f34780b..40a42f1 100644
--- a/drivers/cbus/retu-rtc.c
+++ b/drivers/cbus/retu-rtc.c
@@ -49,16 +49,10 @@ static struct mutex retu_rtc_mutex;
 static u16 retu_rtc_alarm_expired;
 static u16 retu_rtc_reset_occurred;
 
-static DECLARE_COMPLETION(retu_rtc_exited);
 static DECLARE_COMPLETION(retu_rtc_sync);
 
 static void retu_rtc_barrier(void);
 
-static void retu_rtc_device_release(struct device *dev)
-{
-	complete(&retu_rtc_exited);
-}
-
 static ssize_t retu_rtc_time_show(struct device *dev, struct device_attribute *attr,
 				  char *buf)
 {
@@ -428,14 +422,6 @@ static struct device_driver retu_rtc_driver = {
 	.remove		= __devexit_p(retu_rtc_remove),
 };
 
-static struct platform_device retu_rtc_device = {
-	.name		= "retu-rtc",
-	.id		= -1,
-	.dev		= {
-		.release	= retu_rtc_device_release,
-	},
-};
-
 /* This function provides syncronization with the RTCS interrupt handler */
 static void retu_rtc_barrier(void)
 {
@@ -448,29 +434,12 @@ static void retu_rtc_barrier(void)
 
 static int __init retu_rtc_init(void)
 {
-	int ret;
-
-	init_completion(&retu_rtc_exited);
-
-	if ((ret = driver_register(&retu_rtc_driver)) != 0)
-		return ret;
-
-	if ((ret = platform_device_register(&retu_rtc_device)) != 0)
-		goto err_unregister_driver;
-
-	return 0;
-
-err_unregister_driver:
-	driver_unregister(&retu_rtc_driver);
-	return ret;
+	return driver_register(&retu_rtc_driver);
 }
 
 static void __exit retu_rtc_exit(void)
 {
-	platform_device_unregister(&retu_rtc_device);
 	driver_unregister(&retu_rtc_driver);
-
-	wait_for_completion(&retu_rtc_exited);
 }
 
 module_init(retu_rtc_init);
-- 
1.7.11.2


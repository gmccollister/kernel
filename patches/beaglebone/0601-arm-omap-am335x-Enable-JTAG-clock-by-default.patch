From 18c056ff8ec72f80db9cb22e35c352b3376cd1a7 Mon Sep 17 00:00:00 2001
From: Vaibhav Bedia <vaibhav.bedia@ti.com>
Date: Thu, 13 Oct 2011 22:58:43 +0530
Subject: [PATCH 0601/1092] arm:omap:am335x: Enable JTAG clock by default

Signed-off-by: Vaibhav Bedia <vaibhav.bedia@ti.com>
Signed-off-by: Vaibhav Hiremath <hvaibhav@ti.com>
---
 arch/arm/configs/am335x_evm_defconfig      | 1 +
 arch/arm/mach-omap2/omap_hwmod_33xx_data.c | 3 +++
 2 files changed, 4 insertions(+)

diff --git a/arch/arm/configs/am335x_evm_defconfig b/arch/arm/configs/am335x_evm_defconfig
index 4b0aa19..ed8df31 100644
--- a/arch/arm/configs/am335x_evm_defconfig
+++ b/arch/arm/configs/am335x_evm_defconfig
@@ -2122,6 +2122,7 @@ CONFIG_HAVE_ARCH_KGDB=y
 # CONFIG_ARM_UNWIND is not set
 # CONFIG_DEBUG_USER is not set
 # CONFIG_OC_ETM is not set
+CONFIG_DEBUG_JTAG_ENABLE=y
 
 #
 # Security options
diff --git a/arch/arm/mach-omap2/omap_hwmod_33xx_data.c b/arch/arm/mach-omap2/omap_hwmod_33xx_data.c
index c847bc1..c8fe433 100644
--- a/arch/arm/mach-omap2/omap_hwmod_33xx_data.c
+++ b/arch/arm/mach-omap2/omap_hwmod_33xx_data.c
@@ -441,6 +441,9 @@ static struct omap_hwmod am33xx_debugss_hwmod = {
 			.modulemode	= MODULEMODE_SWCTRL,
 		},
 	},
+#ifdef CONFIG_DEBUG_JTAG_ENABLE
+	.flags		= (HWMOD_INIT_NO_IDLE | HWMOD_INIT_NO_RESET),
+#endif
 };
 
 static struct omap_hwmod_class_sysconfig am33xx_elm_sysc = {
-- 
1.7.11.2

